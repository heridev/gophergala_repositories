package main

import (
	"strings"
	"testing"
)

func TestParseJSON(t *testing.T) {
	r := strings.NewReader(sampleJSON)
	info, err := parseJSON(r)
	if err != nil {
		t.Fatal(err)
	}
	if info.MemStats.Alloc == 0 {
		t.Fatal("Data not parsed")
	}
}

var sampleJSON = `{
"cmdline": ["/base/data/home/apps/s~golang-org/godoc.381668649894697170/_ah/exe","-instance_config","{\"soft_memory_limit\":1024,\"max_log_line\":8192,\"clone_key\":\"MDBjNjFiMTE3Y2U2YzAzOWU4ZjQ4NjRkNzljZDY0MGYzMmM4\",\"datacenter\":\"us9\",\"server_software\":\"Google App Engine/1.9.17\"}","-entropy_string=cK6O9qIsHX1IVgLskQFxJrduNn8YYEXZpyhrba9ShFKzjJNr3AXXvkcI1iwJsDa8176j+xzLo3cmBHg8dNwfITaxAlPgheurH2V48fVby4Qzna9QS7/ycBRgEvJs0l/tjvQH+udIMGaxvzJIEaWwuJFJ0Yx7qON66I8b0+MRLPk="],
"httpWriteErrors": {},
"memstats": {"Alloc":325180136,"TotalAlloc":5740595192,"Sys":717304600,"Lookups":8,"Mallocs":43765180,"Frees":40916381,"HeapAlloc":325180136,"HeapSys":667369472,"HeapIdle":304119808,"HeapInuse":363249664,"HeapReleased":0,"HeapObjects":2848799,"StackInuse":180224,"StackSys":180224,"MSpanInuse":1700192,"MSpanSys":3489792,"MCacheInuse":1200,"MCacheSys":16384,"BuckHashSys":2315216,"GCSys":42437777,"OtherSys":1495735,"NextGC":648788192,"LastGC":1422090495206428108,"PauseTotalNs":2329471992,"PauseNs":[123068,92889,116748,128776,141674,257374,515038,359193,573074,825174,971540,1269317,3823504,3765050,3915837,3789846,3328556,3154727,3256306,2768161,3028892,2292395,1917138,1968703,2020814,2125722,1854679,1753019,1638316,1892454,1847058,1928192,1991856,1552099,1719013,1857813,1895556,2666623,2623932,2976134,2482735,4565056,2933945,3140843,4370396,4066654,4147679,3554828,3291088,3666566,3103627,2643188,2074210,2167837,2022899,24913692,63221776,107234041,115336627,111684161,129197330,123002749,125881932,118281630,121009437,130368663,122790417,131287678,118286263,124044272,121565302,121617545,117084186,179706480,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"PauseEnd":[1431723993756201,1431723994009285,1431723994378595,1431723994778536,1431723995611723,1431723997199010,1431723999113535,1431724000462817,1431724002510249,1431724221883382,1431724225200889,1431724230850695,1431724247032285,1431724254439582,1431724265190923,1431724278368390,1431724300778216,1431724319296126,1431724339278291,1431724365933161,1431724389234177,1431724406480144,1431724423640913,1431724439682242,1431724454017521,1431724468295031,1431724484734027,1431724495465790,1431724507372331,1431724525752739,1431724535943413,1431724546997506,1431724557683687,1431724571100854,1431724600189984,1431724630748518,1431724644776520,1431724661623175,1431724681628778,1431724695310501,1431724705639180,1431724722656095,1431724749254060,1431724765235748,1431724789612456,1431724806865815,1431724821352792,1431724841410674,1431724861672563,1431724887368770,1431724911738757,1431724937136644,1431725135403335,1431725728858065,1431726319780383,1431726587315687,1431727047609075,1431727603927488,1431727963015029,1431763638362500,1431889980941306,1432028508378329,1432146336844417,1432273557488014,1432429482081201,1432563864331849,1432653148098582,1432808034528531,1432900464994115,1433015279584038,1433190363912486,1433333621365909,1433472609924825,1433616518655223,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"NumGC":74,"EnableGC":true,"DebugGC":false,"BySize":[{"Size":0,"Mallocs":0,"Frees":0},{"Size":8,"Mallocs":1122685,"Frees":973504},{"Size":16,"Mallocs":12275537,"Frees":11171432},{"Size":32,"Mallocs":12311247,"Frees":10999320},{"Size":48,"Mallocs":3356182,"Frees":3206790},{"Size":64,"Mallocs":3479507,"Frees":3451014},{"Size":80,"Mallocs":1019348,"Frees":982498},{"Size":96,"Mallocs":959537,"Frees":943035},{"Size":112,"Mallocs":526278,"Frees":520163},{"Size":128,"Mallocs":222473,"Frees":214753},{"Size":144,"Mallocs":97052,"Frees":88473},{"Size":160,"Mallocs":82703,"Frees":79151},{"Size":176,"Mallocs":29324,"Frees":26651},{"Size":192,"Mallocs":32677,"Frees":30126},{"Size":208,"Mallocs":348427,"Frees":346077},{"Size":224,"Mallocs":10017,"Frees":8995},{"Size":240,"Mallocs":9161,"Frees":8169},{"Size":256,"Mallocs":110411,"Frees":109171},{"Size":288,"Mallocs":48065,"Frees":46371},{"Size":320,"Mallocs":31750,"Frees":29622},{"Size":352,"Mallocs":200809,"Frees":199507},{"Size":384,"Mallocs":36344,"Frees":35492},{"Size":416,"Mallocs":28385,"Frees":27551},{"Size":448,"Mallocs":6335,"Frees":5533},{"Size":480,"Mallocs":2694,"Frees":2211},{"Size":512,"Mallocs":47341,"Frees":46825},{"Size":576,"Mallocs":11249,"Frees":10492},{"Size":640,"Mallocs":14428,"Frees":13748},{"Size":704,"Mallocs":21287,"Frees":20826},{"Size":768,"Mallocs":3674,"Frees":3198},{"Size":896,"Mallocs":8896,"Frees":8193},{"Size":1024,"Mallocs":20738,"Frees":19966},{"Size":1152,"Mallocs":7337,"Frees":6847},{"Size":1280,"Mallocs":4788,"Frees":4544},{"Size":1408,"Mallocs":14631,"Frees":14372},{"Size":1536,"Mallocs":21478,"Frees":21283},{"Size":1664,"Mallocs":3799,"Frees":3644},{"Size":2048,"Mallocs":16057,"Frees":15784},{"Size":2304,"Mallocs":1943,"Frees":1826},{"Size":2560,"Mallocs":22437,"Frees":22321},{"Size":2816,"Mallocs":2309,"Frees":2168},{"Size":3072,"Mallocs":3872,"Frees":3792},{"Size":3328,"Mallocs":2387,"Frees":2311},{"Size":4096,"Mallocs":47977,"Frees":47813},{"Size":4608,"Mallocs":21065,"Frees":20979},{"Size":5376,"Mallocs":1615,"Frees":1528},{"Size":6144,"Mallocs":1794,"Frees":1672},{"Size":6400,"Mallocs":135,"Frees":123},{"Size":6656,"Mallocs":476,"Frees":457},{"Size":6912,"Mallocs":340,"Frees":321},{"Size":8192,"Mallocs":13418,"Frees":13368},{"Size":8448,"Mallocs":3658,"Frees":3643},{"Size":8704,"Mallocs":136,"Frees":125},{"Size":9472,"Mallocs":299,"Frees":284},{"Size":10496,"Mallocs":4776,"Frees":4743},{"Size":12288,"Mallocs":4464,"Frees":4390},{"Size":13568,"Mallocs":849,"Frees":822},{"Size":14080,"Mallocs":191,"Frees":178},{"Size":16384,"Mallocs":8995,"Frees":8966},{"Size":16640,"Mallocs":24,"Frees":23},{"Size":17664,"Mallocs":380,"Frees":377}]}
}`
